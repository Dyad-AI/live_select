function u(e,t){let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(this,s)},t)}}export default{LiveSelect:{textInput(){return this.el.querySelector("input[type=text]")},debounceMsec(){return parseInt(this.el.dataset.debounce)},updateMinLen(){return parseInt(this.el.dataset.updateMinLen)},maybeStyleClearButton(){const e=this.el.querySelector("button[phx-click=clear]");e&&(this.textInput().style.position="relative",e.style.position="absolute",e.style.top="0px",e.style.bottom="0px",e.style.right="5px")},pushEventToParent(e,t){const n=this.el.dataset.phxTarget;n?this.pushEventTo(n,e,t):this.pushEvent(e,t)},attachDomEventHandlers(){this.textInput().onkeydown=t=>{t.code==="Enter"&&t.preventDefault(),this.pushEventTo(this.el,"keydown",{key:t.code})},this.changeEvents=u((t,n,s)=>{this.pushEventTo(this.el,"change",{text:s}),this.pushEventToParent("live_select_change",{id:this.el.id,field:n,text:s})},this.debounceMsec()),this.textInput().oninput=t=>{const n=t.target.value.trim(),s=this.el.dataset.textInputField;n.length>=this.updateMinLen()?this.changeEvents(this.el.id,s,n):this.pushEventTo(this.el,"options_clear",{})};const e=this.el.querySelector("ul");e&&(e.onmousedown=t=>{const n=t.target.closest("div[data-idx]");n&&this.pushEventTo(this.el,"option_click",{idx:n.dataset.idx})})},setInputValue(e,{focus:t}){this.textInput().value=e,t&&this.textInput().focus()},inputEvent(e,t){const n=t==="single"?"input[class=single-mode]":e.length===0?"input[name=live_select_empty_selection]":"input[type=hidden]";this.el.querySelector(n).dispatchEvent(new Event("input",{bubbles:!0}))},mounted(){this.maybeStyleClearButton(),this.handleEvent("parent_event",({id:e,event:t,payload:n})=>{this.el.id===e&&this.pushEventToParent(t,n)}),this.handleEvent("select",({id:e,selection:t,mode:n,focus:s,input_event:l,parent_event:i})=>{if(this.el.id===e){if(n==="single"){const h=t.length>0?t[0].label:null;this.setInputValue(h,{focus:s})}else this.setInputValue(null,{focus:s});l&&this.inputEvent(t,n),i&&this.pushEventToParent(i,{id:e})}}),this.attachDomEventHandlers()},updated(){this.maybeStyleClearButton(),this.attachDomEventHandlers()}}};
