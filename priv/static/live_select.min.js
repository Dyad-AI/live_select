function u(t,e){let s;return(...n)=>{clearTimeout(s),s=setTimeout(()=>{t.apply(this,n)},e)}}export default{LiveSelect:{textInput(){return this.el.querySelector("input[type=text]")},debounceMsec(){return parseInt(this.el.dataset.debounce)},updateMinLen(){return parseInt(this.el.dataset.updateMinLen)},maybeStyleClearButton(){const t=this.el.querySelector("button[phx-click=clear]");t&&(this.textInput().style.position="relative",t.style.position="absolute",t.style.top="0px",t.style.bottom="0px",t.style.right="5px",t.style.display="block")},pushEventToParent(t,e){const s=this.el.dataset.phxTarget;s?this.pushEventTo(s,t,e):this.pushEvent(t,e)},attachDomEventHandlers(){this.textInput().onkeydown=e=>{e.code==="Enter"&&e.preventDefault(),this.pushEventTo(this.el,"keydown",{key:e.code})},this.changeEvents=u((e,s,n)=>{this.pushEventTo(this.el,"change",{text:n}),this.pushEventToParent("live_select_change",{id:this.el.id,field:s,text:n})},this.debounceMsec()),this.textInput().oninput=e=>{const s=e.target.value.trim(),n=this.el.dataset.field;s.length>=this.updateMinLen()?this.changeEvents(this.el.id,n,s):this.pushEventTo(this.el,"options_clear",{})};const t=this.el.querySelector("ul");t&&(t.onmousedown=e=>{const s=e.target.closest("div[data-idx]");s&&this.pushEventTo(this.el,"option_click",{idx:s.dataset.idx})})},setInputValue(t,{focus:e}){this.textInput().value=t,e&&this.textInput().focus()},inputEvent(t,e){const s=e==="single"?"input[class=single-mode]":t.length===0?"input[name=live_select_empty_selection]":"input[type=hidden]";this.el.querySelector(s).dispatchEvent(new Event("input",{bubbles:!0}))},mounted(){this.maybeStyleClearButton(),this.handleEvent("parent_event",({id:t,event:e,payload:s})=>{this.el.id===t&&this.pushEventToParent(e,s)}),this.handleEvent("select",({id:t,selection:e,mode:s,focus:n,input_event:l,parent_event:i})=>{if(this.el.id===t){if(s==="single"){const h=e.length>0?e[0].label:null;this.setInputValue(h,{focus:n})}else this.setInputValue(null,{focus:n});l&&this.inputEvent(e,s),i&&this.pushEventToParent(i,{id:t})}}),this.attachDomEventHandlers()},updated(){this.maybeStyleClearButton(),this.attachDomEventHandlers()}}};
